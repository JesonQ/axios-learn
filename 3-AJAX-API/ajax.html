<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>发送AJAX请求</title>
    <link href="https://cdn.bootcss.com/twitter-bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>
    <div class="container">
        <h2 class="page-header">AJAX API</h2>
        <button id="btn" class="btn btn-primary">发送ajax GET请求</button>
        <button id="btn2" class="btn btn-primary">发送ajax POST请求</button>
        <button id="btn3" class="btn btn-primary">发送ajax 超时请求</button>
        <button id="quxiao" class="btn btn-danger">取消</button>
    </div>
</body>
<script>
    let btns = document.querySelectorAll("button")
    // get
    let xhr;
    btns[0].onclick = function () {
        xhr = new XMLHttpRequest()
        xhr.responseType = "json"
        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4) {
                if (xhr.status === 200) {
                    // console.log(xhr.responseText)
                    console.log(xhr.response)
                    console.log(xhr.getAllResponseHeaders())
                    console.log(xhr.getResponseHeader("date"))
                }
            }
        }
        xhr.open("get", "http://localhost:8000/delay-server")
        xhr.send()
    }

    // post
    btns[1].onclick = function () {
        let x = new XMLHttpRequest()
        x.onreadystatechange = function () {
            if (x.readyState === 4) {
                if (x.status === 200) {
                    console.log(x.responseText)
                }
            }
        }
        let data = { a: 100, b: 200 }
        x.open("post", "http://localhost:8000/server")
        // json
        // let body = JSON.stringify(data)
        // x.setRequestHeader("Content-type", "application/json")
        // x.send(body)
        // urlencoded
        let query = ""
        for (let i in data) {
            query += `${i}=${data[i]}&`
        }
        query = query.substr(0, query.length - 1)
        x.setRequestHeader("content-type","application/x-www-form-urlencoded")
        x.send(query)
    }
    // 超时请求
    btns[2].addEventListener("click", function () {
        let x = new XMLHttpRequest()
        x.timeout = 2000
        x.ontimeout = function () {
            console.log("超时回来,我不要了,thanks")
        }
        // x.onerror = function (){
        //     console.log("哎呀,页面走丢了")
        // }
        x.onreadystatechange = function () {
            if (x.readyState === 4) {
                if (x.status === 200) {
                    console.log(x.response)
                }
            }
        }
        x.open("post", "http://localhost:8000/server")
        x.send()
    })

    // 中断请求
    
    btns[3].onclick = function () {
        xhr.abort()
    }



</script>

<script>

</script>


</html>